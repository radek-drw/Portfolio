<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Get reCAPTCHA v3 Token (Dev)</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
  </head>
  <body
    style="
      font-family:
        system-ui,
        Segoe UI,
        Roboto,
        Arial,
        sans-serif;
      padding: 16px;
    "
  >
    <h2>Get reCAPTCHA v3 Token (Dev)</h2>

    <p>
      Make sure <strong>localhost</strong> is added in the Google reCAPTCHA panel for this site key.
    </p>

    <p style="color: #b30000; font-weight: bold;">
      ⚠️ This file must be run via a <strong>local server</strong> (e.g.
      <code>http://localhost:3000/get-token.html</code>), <strong>not</strong> via
      <code>file:///C:/...</code>. Otherwise, reCAPTCHA will not work!
    </p>

    <p style="font-style: italic; color: #555;">
      To start a local server, you can use one of the following methods:
      <ul>
        <li><strong>Node.js:</strong> run <code>npx serve .</code> in this folder</li>
      </ul>
    </p>

    <button id="getBtn">Get Token</button>

    <p>
      <label>Token (copy and paste into Thunder Client):</label>
      <textarea id="out" rows="4" style="width: 100%; margin-top: 8px"></textarea>
    </p>

    <script>
      const siteKey = '""';

      // Load reCAPTCHA v3
      (function loadRecaptcha() {
        if (window.grecaptcha && window.grecaptcha.execute) return;
        const s = document.createElement('script');
        s.src = 'https://www.google.com/recaptcha/api.js?render=' + encodeURIComponent(siteKey);
        s.async = true;
        s.defer = true;
        document.head.appendChild(s);
      })();

      document.getElementById('getBtn').onclick = async function () {
        try {
          await new Promise((resolve, reject) => {
            const max = Date.now() + 15000;
            (function waitReady() {
              if (window.grecaptcha && typeof window.grecaptcha.execute === 'function')
                return resolve();
              if (Date.now() > max) return reject(new Error('grecaptcha not loaded'));
              setTimeout(waitReady, 200);
            })();
          });

          const token = await grecaptcha.execute(siteKey, { action: 'submit' });
          document.getElementById('out').value = token;

          try {
            await navigator.clipboard.writeText(token);
            alert('Token copied to clipboard');
          } catch (e) {
            // Clipboard might not work in file:// or some restrictions
          }
        } catch (err) {
          alert('Error: ' + (err && err.message ? err.message : err));
          console.error(err);
        }
      };
    </script>
  </body>
</html>
