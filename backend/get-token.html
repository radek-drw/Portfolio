<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Get reCAPTCHA v3 token (dev)</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
  </head>
  <body
    style="
      font-family:
        system-ui,
        Segoe UI,
        Roboto,
        Arial,
        sans-serif;
      padding: 16px;
    "
  >
    <h2>Get reCAPTCHA v3 token (dev)</h2>
    <p>
      Upewnij się, że <strong>localhost</strong> jest dodany w panelu Google reCAPTCHA dla tego site
      key.
    </p>
    <button id="getBtn">Get token</button>
    <p>
      <label>Token (skopiuj i wklej do Thunder Client):</label>
      <textarea id="out" rows="4" style="width: 100%; margin-top: 8px"></textarea>
    </p>
    <script>
      // Zastąp siteKey własnym site key jeśli inny
      const siteKey = '6LeVl8orAAAAAJkAyH4MRlTaKwcAr_bZfYRH55vc';

      // Załaduj reCAPTCHA v3
      (function loadRecaptcha() {
        if (window.grecaptcha && window.grecaptcha.execute) return;
        const s = document.createElement('script');
        s.src = 'https://www.google.com/recaptcha/api.js?render=' + encodeURIComponent(siteKey);
        s.async = true;
        s.defer = true;
        document.head.appendChild(s);
      })();

      document.getElementById('getBtn').onclick = async function () {
        try {
          // Poczekaj aż grecaptcha będzie gotowy
          await new Promise((resolve, reject) => {
            const max = Date.now() + 15000;
            (function waitReady() {
              if (window.grecaptcha && typeof window.grecaptcha.execute === 'function')
                return resolve();
              if (Date.now() > max) return reject(new Error('grecaptcha not loaded'));
              setTimeout(waitReady, 200);
            })();
          });

          const token = await grecaptcha.execute(siteKey, { action: 'submit' });
          document.getElementById('out').value = token;

          try {
            await navigator.clipboard.writeText(token);
            alert('Token skopiowany do schowka');
          } catch (e) {
            // clipboard może nie działać w file:// lub przy ograniczeniach — użytkownik skopiuje ręcznie
          }
        } catch (err) {
          alert('Błąd: ' + (err && err.message ? err.message : err));
          console.error(err);
        }
      };
    </script>
  </body>
</html>
